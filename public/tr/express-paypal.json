{
	"name": "express-paypal",
	"description": "PayPal template for Express",
	"framework": "express",
	"files": [
		{
			"target": "src/lib/paypal.ts",
			"type": "template",
			"content": "import paypal from '@paypal/checkout-server-sdk'\n\nlet paypalClient: paypal.core.PayPalHttpClient | null = null\n\nexport function getPayPalClient(): paypal.core.PayPalHttpClient {\n  if (!paypalClient) {\n    const clientId = process.env.PAYPAL_CLIENT_ID\n    const clientSecret = process.env.PAYPAL_CLIENT_SECRET\n    if (!clientId || !clientSecret) {\n      throw new Error('PAYPAL_CLIENT_ID/PAYPAL_CLIENT_SECRET are not set')\n    }\n    const environment = process.env.PAYPAL_ENV === 'live'\n      ? new paypal.core.LiveEnvironment(clientId, clientSecret)\n      : new paypal.core.SandboxEnvironment(clientId, clientSecret)\n    paypalClient = new paypal.core.PayPalHttpClient(environment)\n  }\n  return paypalClient\n}\n"
		},
		{
			"target": "src/routes/paypal/route.ts",
			"type": "template",
			"content": "import express from 'express'\nimport { checkoutRouter } from './checkout'\nimport { orderRouter } from './order'\nimport { webhookRouter } from './webhook'\n\nconst router = express.Router()\n// Mount webhook route before any express.json() middleware to preserve raw body\nrouter.use('/webhook', webhookRouter)\nrouter.use(express.json()) // Ensure request body is parsed for other routes\nrouter.use('/checkout', checkoutRouter)\nrouter.use('/order', orderRouter)\nexport { router as paypalRouter }\n"
		},
		{
			"target": "src/routes/paypal/checkout.ts",
			"type": "template",
			"content": "import express from 'express'\nimport paypal from '@paypal/checkout-server-sdk'\nimport { z } from 'zod'\nimport { getPayPalClient } from '../../lib/paypal'\n\nconst router = express.Router()\n\nconst schema = z.object({\n  amount: z.string().regex(/^\\\\d+(\\\\.\\\\d{1,2})?$/).transform(Number).refine(val => val > 0, { message: 'Amount must be greater than 0' }),\n  currency: z.string().regex(/^[A-Z]{3}$/, { message: 'Currency must be a 3-letter uppercase code' }).refine(currency => ['USD', 'EUR', 'GBP', 'CAD', 'AUD', 'JPY', 'CNY'].includes(currency), { message: 'Unsupported currency' }),\n})\n\nrouter.post('/', async (req, res) => {\n  try {\n    const parsed = schema.safeParse(req.body)\n    if (!parsed.success) {\n      return res.status(400).json({ error: 'Invalid input', details: parsed.error.flatten() })\n    }\n    const requestOrder = new paypal.orders.OrdersCreateRequest()\n    requestOrder.headers['Prefer'] = 'return=representation'\n    requestOrder.requestBody({\n      intent: 'CAPTURE',\n      purchase_units: [{ amount: { currency_code: parsed.data.currency, value: parsed.data.amount.toFixed(2) } }],\n    })\n    const client = getPayPalClient()\n    const response = await client.execute(requestOrder)\n    res.json(response.result)\n  } catch (e) {\n    res.status(500).json({ error: 'Internal error' })\n  }\n})\n\nexport { router as checkoutRouter }\n"
		},
		{
			"target": "src/routes/paypal/order.ts",
			"type": "template",
			"content": "import express from 'express'\nimport paypal from '@paypal/checkout-server-sdk'\nimport { getPayPalClient } from '../../lib/paypal'\n\nconst router = express.Router()\n\nrouter.post('/capture', async (req, res) => {\n  try {\n    // Validate req.body is an object\n    if (!req.body || typeof req.body !== 'object') {\n      return res.status(400).json({ error: 'Request body must be a JSON object' })\n    }\n    \n    const { orderId } = req.body as { orderId?: string }\n    \n    // Validate orderId is present and non-empty\n    if (!orderId || typeof orderId !== 'string' || orderId.trim() === '') {\n      return res.status(400).json({ error: 'orderId is required and must be a non-empty string' })\n    }\n    \n    const client = getPayPalClient()\n    const capReq = new paypal.orders.OrdersCaptureRequest(orderId)\n    capReq.requestBody({})\n    const response = await client.execute(capReq)\n    res.json(response.result)\n  } catch {\n    res.status(500).json({ error: 'Internal error' })\n  }\n})\n\nrouter.get('/:orderId', async (req, res) => {\n  try {\n    // Validate orderId parameter is present and non-empty\n    const { orderId } = req.params\n    if (!orderId || typeof orderId !== 'string' || orderId.trim() === '') {\n      return res.status(400).json({ error: 'orderId parameter is required and must be a non-empty string' })\n    }\n    \n    const client = getPayPalClient()\n    const getReq = new paypal.orders.OrdersGetRequest(orderId)\n    const response = await client.execute(getReq)\n    res.json(response.result)\n  } catch {\n    res.status(500).json({ error: 'Internal error' })\n  }\n})\n\nexport { router as orderRouter }\n"
		},
		{
			"target": "src/routes/paypal/webhook.ts",
			"type": "template",
			"content": "import express from 'express'\nimport paypal from '@paypal/checkout-server-sdk'\nimport { getPayPalClient } from '../../lib/paypal'\n\nconst router = express.Router()\n\nrouter.post('/', express.raw({ type: 'application/json' }), async (req, res) => {\n  try {\n    // Verify PayPal webhook signature\n    const client = getPayPalClient()\n    const verifyRequest = new paypal.notifications.VerifyWebhookSignatureRequest()\n    \n    // Get webhook ID from environment variables\n    const webhookId = process.env.PAYPAL_WEBHOOK_ID\n    if (!webhookId) {\n      console.error('PAYPAL_WEBHOOK_ID is not set in environment variables')\n      return res.status(500).json({ error: 'Webhook verification not configured' })\n    }\n    \n    // Prepare verification payload\n    verifyRequest.requestBody({\n      auth_algo: req.headers['paypal-auth-algo'],\n      cert_url: req.headers['paypal-cert-url'],\n      transmission_id: req.headers['paypal-transmission-id'],\n      transmission_sig: req.headers['paypal-transmission-sig'],\n      transmission_time: req.headers['paypal-transmission-time'],\n      webhook_id: webhookId,\n      webhook_event: JSON.parse(req.body.toString())\n    })\n    \n    // Execute verification\n    const verifyResponse = await client.execute(verifyRequest)\n    \n    // Check verification result\n    if (verifyResponse.result.verification_status !== 'SUCCESS') {\n      console.warn('PayPal webhook signature verification failed')\n      return res.status(400).json({ error: 'Webhook signature verification failed' })\n    }\n    \n    // Process verified webhook event\n    const event = JSON.parse(req.body.toString())\n    console.log('Verified PayPal webhook event received:', event.event_type)\n    \n    // TODO: Handle specific webhook events (e.g., payment completed, subscription cancelled, etc.)\n    \n    res.status(200).json({ received: true })\n  } catch (error) {\n    console.error('Error processing PayPal webhook:', error)\n    res.status(500).json({ error: 'Internal error processing webhook' })\n  }\n})\n\nexport { router as webhookRouter }\n"
		},
		{
			"target": ".env.example",
			"type": "template",
			"content": "PAYPAL_CLIENT_ID=YOUR-CLIENT-ID\nPAYPAL_CLIENT_SECRET=YOUR-CLIENT-SECRET\nPAYPAL_ENV=sandbox\nPAYPAL_WEBHOOK_ID=YOUR-WEBHOOK-ID\nNEXT_PUBLIC_APP_URL=http://localhost:8080/paypal"
		}
	],
	"dependencies": [
		"@paypal/checkout-server-sdk",
		"zod",
		"express",
		"@types/express"
	]
}
